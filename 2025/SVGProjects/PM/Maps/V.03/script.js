// const abortionData = {
//   /* your JSON here */
//   Iceland: {
//     current_laws: {
//       on_demand_up_to_weeks: 22,
//       after_weeks: "health emergencies, fetal abnormalities",
//       healthcare_coverage: true,
//     },
//     timeline: [
//       { year: 1935, event: "Abortion legalized under restrictive conditions" },
//       { year: 2019, event: "On-demand abortion legalized up to 22 weeks" },
//     ],
//     activism: "Strong women's movement and progressive policy",
//   },
//   Norway: {
//     current_laws: {
//       on_demand_up_to_weeks: 12,
//       after_weeks: "health, fetal abnormalities, committee approval",
//       healthcare_coverage: true,
//     },
//     timeline: [
//       { year: 1960, event: "Abortion permitted under restrictive conditions" },
//       { year: 1978, event: "On-demand abortion legalized up to 12 weeks" },
//     ],
//     activism: "1978 reform influenced by advocates for women's health",
//   },
//   Ireland: {
//     current_laws: {
//       on_demand_up_to_weeks: 12,
//       after_weeks: "health risks, fetal abnormalities",
//       healthcare_coverage: true,
//     },
//     timeline: [
//       {
//         year: 1861,
//         event: "Offences against the Person Act criminalized abortion",
//       },
//       { year: 2018, event: "Eighth Amendment repealed by referendum" },
//       { year: 2019, event: "New abortion law came into force" },
//     ],
//     activism: "Together for Yes, strong grassroots movement for change",
//   },
//   UK: {
//     current_laws: {
//       on_demand_up_to_weeks: 24,
//       after_weeks: "health risks, fetal abnormalities",
//       healthcare_coverage: true,
//     },
//     timeline: [
//       {
//         year: 1861,
//         event: "Offences against the Person Act criminalized abortion",
//       },
//       { year: 1967, event: "Abortion Act legalized abortion under conditions" },
//       { year: 2019, event: "Northern Ireland decriminalized abortion" },
//     ],
//     activism:
//       "1967 reform influenced by health advocates; 2019 change due to human rights campaigns",
//   },
//   Argentina: {
//     current_laws: {
//       on_demand_up_to_weeks: 14,
//       after_weeks: " rape, health risks",
//       healthcare_coverage: true,
//     },
//     timeline: [
//       {
//         year: 1921,
//         event: "Abortion permitted in cases of rape or health danger",
//       },
//       { year: 2020, event: "On-demand abortion legalized up to 14 weeks" },
//     ],
//     activism:
//       "Green Wave movement (Marea Verde) played key role in legalization",
//   },
//   Colombia: {
//     current_laws: {
//       on_demand_up_to_weeks: 24,
//       after_weeks: " health risks, rape, fetal abnormalities",
//       healthcare_coverage: true,
//     },
//     timeline: [
//       {
//         year: 2006,
//         event:
//           "Constitutional Court legalized abortion under certain conditions",
//       },
//       {
//         year: 2022,
//         event: "Constitutional Court extends on-demand abortion to 24 weeks",
//       },
//     ],
//     activism:
//       "Colombian feminists and Causa Justa movement challenged restrictive laws",
//   },
//   Mexico: {
//     current_laws: {
//       on_demand_up_to_weeks: 12,
//       after_weeks: " health, rape, fetal abnormalities (varies by state)",
//     },
//     timeline: [
//       { year: 2007, event: "Mexico City legalized abortion up to 12 weeks" },
//       {
//         year: 2021,
//         event: "Supreme Court ruling decriminalized abortion nationally",
//       },
//     ],
//     activism:
//       "Marea Verde and advocates successfully challenged restrictive laws",
//   },
//   Canada: {
//     current_laws: {
//       on_demand_up_to_weeks: " no legal limit",
//       after_weeks: " governed by health care providers’ judgment",
//       healthcare_coverage: true,
//     },
//     timeline: [
//       {
//         year: 1969,
//         event: "Law amended to allow abortion under certain conditions",
//       },
//       {
//         year: 1988,
//         event: "Supreme Court struck down abortion law in R v Morgentaler",
//       },
//       {
//         year: 1988,
//         event: "Successive governments have not passed new abortion laws, leaving regulation to provincial healthcare systems.",
//       },
//     ],
//     activism:
//       "Dr. Henry Morgentaler challenged restrictive laws; Supreme Court ruling made abortion a matter of health care",
//   },
//   USA: {
//     current_laws: {
//       on_demand_up_to_weeks: " varies by state",
//       after_weeks: " health, rape, fetal abnormalities (varies by state)",
//     },
//     timeline: [
//       { year: 1973, event: "Roe v Wade legalized abortion across USA" },
//       {
//         year: 2022,
//         event:
//           "Dobbs v Jackson overturned Roe v Wade, allowing states to regulate abortion",
//       },
//     ],
//     activism:
//       "Deep political divisions; ongoing legal battles over abortion access",
//   },
//   Germany: {
//     current_laws: {
//       on_demand_up_to_weeks: 12,
//       after_weeks: " health risks, rape, fetal abnormalities",
//       healthcare_coverage: true,
//     },
//     timeline: [
//       {
//         year: 1976,
//         event: "Indications Model legalized abortion under conditions",
//       },
//       {
//         year: 1995,
//         event:
//           "Current framework after reunification; abortion legal within first 12 weeks with counseling",
//       },
//     ],
//     activism:
//       "Debate influenced by women's groups and German Constitutional Court decisions",
//   },
// };

const abortionData = {
  /* Updated Timelines Below */
  Iceland: {
    current_laws: {
      on_demand_up_to_weeks: 22,
      after_weeks: "health emergencies, fetal abnormalities",
      healthcare_coverage: true,
    },
    timeline: [
      {
        year: "1935",
        event:
          "Abortion legalized under certain conditions, such as health risks to the mother or fetal abnormalities, and rape cases.",
          image: "avatar3_big.png"
      },
      {
        year: "1975",
        event:
          "The Law on abortion and sterilization was passed, broadening conditions, making abortion more accessible under a range of social and health grounds.",
          image: "bird.png"
      },
      {
        year: "2019",
        event:
          "The Icelandic Parliament (Althing) approved a new abortion law, allowing abortion on request up to the 22nd week of pregnancy, regardless of circumstances.",
          image: "avatar3_big.png"
      },
    ],
    activism: "Strong women's movement and progressive policy",
  },
  Norway: {
    current_laws: {
      on_demand_up_to_weeks: 12,
      after_weeks: "health, fetal abnormalities, committee approval",
      healthcare_coverage: true,
    },
    timeline: [
      { year: 1960, event: "Abortion permitted under restrictive conditions", image: "avatar3_big.png" }, // Kept from original JSON
      {
        year: "1978",
        event:
          "Norway legalized abortion on request during the first 12 weeks of pregnancy.",
          image: "bird.png"
      },
      {
        year: "1978",
        event:
          "After 12 weeks, and up to 18 weeks, abortion may be approved by a committee of two doctors if certain conditions (such as health, socioeconomic, or fetal abnormalities) are met.",
          image: "avatar3_big.png"
      },
      {
        year: "1978",
        event:
          "After 18 weeks, abortion is permitted only in cases of severe health risks or fetal abnormalities, and must be approved by a special hospital committee.",
          image: "bird.png"
      },
    ],
    activism: "1978 reform influenced by advocates for women's health",
  },
  Ireland: {
    current_laws: {
      on_demand_up_to_weeks: 12,
      after_weeks: "health risks, fetal abnormalities",
      healthcare_coverage: true,
    },
    timeline: [
      {
        year: 1861, // Kept from original JSON
        event: "Offences against the Person Act criminalized abortion",
        image: "avatar3_big.png"
      },
      {
        year: "1983",
        event:
          "The constitutional ban on abortion was put in place, recognising the equal right to life of the mother and the unborn.",
          image: "bird.png"
      },
      {
        year: "2013",
        event:
          "Protection of Life During Pregnancy Act was enacted, allowing abortion only in cases where there is a real and substantial risk to the life of the mother.",
          image: "avatar3_big.png"
      },
      {
        year: "2018",
        event:
          "Referendum. Ireland voted by a two-thirds majority to repeal the Eighth Amendment, which had effectively banned abortion.",
          image: "bird.png"
      },
      {
        year: "2019",
        event:
          "Health (Regulation of Termination of Pregnancy) The new abortion framework came into force on 1 January 2019.",
          image: "avatar3_big.png"
      },
    ],
    activism: "Together for Yes, strong grassroots movement for change",
  },
  UK: { // Matched to your HTML's outer-UK
    current_laws: {
      on_demand_up_to_weeks: 24,
      after_weeks: "health risks, fetal abnormalities",
      healthcare_coverage: true,
    },
    timeline: [
      {
        year: "1861",
        event:
          "The Offences Against the Person Act: Abortion was a criminal offense across the UK",
          image: "avatar3_big.png"
      },
      {
        year: "1967",
        event:
          "The Abortion Act 1967 was passed, legalizing abortion under certain conditions, following a clinician's approval.",
          image: "bird.png"
      },
      {
        year: "2019",
        event:
          "(Northern Ireland) The Northern Ireland (Executive Formation and Exercise of Functions) Act 2019 decriminalized abortion in Northern Ireland and legalized it broadly from October 2019.",
          image: "avatar3_big.png"
      },
    ],
    activism:
      "1967 reform influenced by health advocates; 2019 change due to human rights campaigns",
  },
  Argentina: {
    current_laws: {
      on_demand_up_to_weeks: 14,
      after_weeks: " rape, health risks",
      healthcare_coverage: true,
    },
    timeline: [
      {
        year: "Pre-1921",
        event:
          "Abortion was fully criminalized, punishable under Argentina's 1887 and 1903 codes",
          image: "avatar3_big.png"
      },
      {
        year: "1921",
        event:
          "Partial decriminalization introduced-allowed in cases of rape, or when health/life of the mother was at risk. However, the law was rarely applied in practice.",
          image: "bird.png"
      },
      {
        year: "2012",
        event:
          "Supreme Court ruling (F.A.I) confirmed victims of rape can undergo abortions without judicial approval - only a sworn statement was needed.",
          image: "avatar3_big.png"
      },
      {
        year: "Dec 30 2020",
        event:
          "Congress passed Law 27.610, legalizing abortion on request up to 14 weeks and beyond that for rape, health risk, or life risk.",
          image: "bird.png"
      },
    ],
    activism:
      "Green Wave movement (Marea Verde) played key role in legalization",
  },
  Colombia: {
    current_laws: {
      on_demand_up_to_weeks: 24,
      after_weeks: " health risks, rape, fetal abnormalities",
      healthcare_coverage: true,
    },
    timeline: [
      {
        year: "Pre-2006",
        event:
          "Abortions were fully criminalized, with only rare exceptions historically (e.g. life-saving procedures). Women often faced 1-3 years in prison, and unsafe abortions were the leading cause of maternal mortality",
          image: "avatar3_big.png"
      },
      {
        year: "May 2006 - Ruling C-355",
        event:
          "The constitutional Court created three legal exceptions: 1. Rape, incest, or non-consensual insemination 2. Fetal malformation incompatible with life 3. When the mother's life or health is at risk",
          image: "bird.png"
      },
      {
        year: "2006-2021",
        event:
          "Despite new legal allowances, many women, especially in rural areas, faced barriers like unnecessary consent procedures, conscientious objection by providers and lack of awareness.",
          image: "avatar3_big.png"
      },
      {
        year: "Feb 21, 2022",
        event:
          "The Constitutional Court decriminalized abortion up to 24 weeks on any grounds, recognizing it as a matter of reproductive health and autonomy. Post-24 weeks, the previous three exceptions apply.",
          image: "bird.png"
      },
    ],
    activism:
      "Colombian feminists and Causa Justa movement challenged restrictive laws",
  },
  Mexico: {
    current_laws: {
      on_demand_up_to_weeks: 12,
      after_weeks: " health, rape, fetal abnormalities (varies by state)",
    },
    timeline: [
      {
        year: "1931",
        event:
          "Abortion was criminalized nationwide, with exceptions only for cases of rape, danger to the mother's life, or non-consensual acts.",
          image: "avatar3_big.png"
      },
      {
        year: "1974",
        event:
          "Mexico amended its constitution to recognize every citizen's \"right to freely decide, in a responsible and informed manner, on the number and spacing of their children.",
          image: "bird.png"
      },
      {
        year: "2007",
        event:
          "Mexico City became the first jurisdiction to decriminalize elective abortion up to 12 weeks of pregnancy, offering free services to residents.",
          image: "avatar3_big.png"
      },
      {
        year: "2021",
        event:
          "The Supreme Court ruled that criminal penalties for abortion were unconstitutional, setting a precedent that judges could not sentence individuals for undergoing or assisting in abortions, even if local laws had not changed.",
          image: "bird.png"
      },
      {
        year: "2023",
        event:
          "The Supreme Court decriminalized abortion in the federal penal code, allowing access to abortion services in federal healthcare facilities across all states.",
          image: "avatar3_big.png"
      },
    ],
    activism:
      "Marea Verde and advocates successfully challenged restrictive laws",
  },
  Canada: {
    current_laws: {
      on_demand_up_to_weeks: " no legal limit",
      after_weeks: " governed by health care providers’ judgment",
      healthcare_coverage: true,
    },
    timeline: [
      {
        year: "1969",
        event:
          "Prime Minister Pierre Trudeau reformed the law to allow abortion if approved by a hospital’s Therapeutic Abortion Committee (TAC), which assessed whether the pregnancy endangered the woman's physical or mental health.",
          image: "1969.png"
      },
      {
        year: 1988, // Kept from original JSON
        event: "Supreme Court struck down abortion law in R v Morgentaler",
        image: "DrMorgentaler.png"
      },
      {
        year: "Post 1988",
        event:
          "Successive governments have not passed new abortion laws, leaving regulation to provincial healthcare systems.",
          image: "1988.png"
      },
    ],
    activism:
      "Dr. Henry Morgentaler challenged restrictive laws; Supreme Court ruling made abortion a matter of health care",
  },
  USA: { // Matched to your HTML's outer-USA
    current_laws: {
      on_demand_up_to_weeks: " varies by state",
      after_weeks: " health, rape, fetal abnormalities (varies by state)",
    },
    timeline: [
      {
        year: "Pre-19th Century",
        event:
          "Abortion was generally legal before \"quickening\" (the first noticeable fetal movement, around 18-21 weeks). Early laws focused more on regulating providers than penalizing women.",
          image: "avatar3_big.png"
      },
      {
        year: "1821",
        event:
          "Connecticut enacted the first abortion regulation, criminalizing post-quickening procedures.",
          image: "bird.png"
      },
      {
        year: "Mid-o-late 1800's",
        event:
          "A wave of anti-abortion laws emerged, influenced by the <em>American Medical Association's</em> efforts to professionalize medicine and concerns about unregulated practicioners.",
          image: "avatar3_big.png"
      },
      {
        year: "1973",
        event:
          "In <em>Roe v. Wade</em>, the Supreme Court recognized a constituional right to abortion, legalizing it nationwide and establishing a trimester framework for regulation.",
          image: "bird.png"
      },
      {
        year: "1992",
        event:
          "<em>Planned Parenthood v. Casey</em> reaffirmed Roe but replaced the trimester framework with the \"undue burden\" standard, allowing more state-level restrictions.",
          image: "avatar3_big.png"
      },
      {
        year: "2022",
        event:
          "<em>Dobbs v. Jackson Women's Health Organization</em> overturned <em>Roe</em>, eliminating federal constitutional protection for abortion and returning regulatory authority to individual states.",
          image: "bird.png"
      },
    ],
    activism:
      "Deep political divisions; ongoing legal battles over abortion access",
  },
  Germany: { // Untouched, as requested
    current_laws: {
      on_demand_up_to_weeks: 12,
      after_weeks: " health risks, rape, fetal abnormalities",
      healthcare_coverage: true,
    },
    timeline: [
      {
        year: 1976,
        event: "Indications Model legalized abortion under conditions",
        image: "avatar3_big.png"
      },
      {
        year: 1995,
        event:
          "Current framework after reunification; abortion legal within first 12 weeks with counseling",
        image: "bird.png"
      },
    ],
    activism:
      "Debate influenced by women's groups and German Constitutional Court decisions",
  },
};

class CountryAbortionInfo {
  constructor(data, wrapperInfoSelector, outerContainerSelector) {
    this.data = data;
    this.wrapperInfo = document.querySelector(wrapperInfoSelector);
    this.outerContainer = document.querySelector(outerContainerSelector);
  }

  formatCountryName(name) {
    return name.replace(/_/g, "-");
  }

  createTextInfo(country, info) {
    const div = document.createElement("div");
    const className = `text-info text-${this.formatCountryName(country)}`;
    div.className = className;

    let originalDate = info.timeline[0]?.year || "N/A";
    let summary = info.timeline[0]?.event || "";
    let currentStatus = `Abortion is legal on demand up to ${info.current_laws.on_demand_up_to_weeks} weeks. After that: ${info.current_laws.after_weeks}.`;
    if (info.current_laws.healthcare_coverage) {
      currentStatus += ` Covered by public healthcare.`;
    }

    div.innerHTML = `
            <h2>${country.replace(/_/g, " ")}</h2>
            <div class="info">
                <div class="original-date">${originalDate}</div>
                <div class="summary">${summary}</div>
                <div class="current-status">${currentStatus}</div>
            </div>
        `;
    this.wrapperInfo.appendChild(div);
  }

  // createSlider(country, timeline) {
  //   const outerDiv = document.createElement("div");
  //   outerDiv.className = `outer outer-${this.formatCountryName(country)}`;

  //   const sliderDiv = document.createElement("div");
  //   sliderDiv.className = "slider";

  //   timeline.forEach((entry, index) => {
  //     const section = document.createElement("section");
  //     section.innerHTML = `
  //               <div class="inner">
  //                   <img src="${
  //                     index % 2 === 0 ? "1969.png" : "DrMorgentaler.png"
  //                   }" alt="" />
  //                   <div class="content">
  //                       <h2>${entry.year}</h2>
  //                       <p>${entry.event}</p>
  //                   </div>
  //               </div>
  //           `;
  //     sliderDiv.appendChild(section);
  //   });

  //   outerDiv.appendChild(sliderDiv);
  //   this.outerContainer.appendChild(outerDiv);
  // }

  //

// Updated createSlider method to use generic images

createSlider(country, timeline) {
    const outerDiv = document.createElement("div");
    outerDiv.className = `outer outer-${this.formatCountryName(country)}`;

    const sliderDiv = document.createElement("div");
    sliderDiv.className = "slider";

    // Loop through each timeline entry
    timeline.forEach((entry) => {
      const section = document.createElement("section");

      // Check if an image path is provided.
      // If entry.image is "" or null, it will create an empty string.
      let imageTag = "";
      if (entry.image) {
        imageTag = `<img src="${entry.image}" alt="Image related to ${entry.year}" />`;
      }

      // Use the imageTag variable in the template.
      section.innerHTML = `
                <div class="inner">
                    ${imageTag}
                    <div class="content">
                        <h2>${entry.year}</h2>
                        <p>${entry.event}</p>
                    </div>
                </div>
            `;
      sliderDiv.appendChild(section);
    });

    outerDiv.appendChild(sliderDiv);
    this.outerContainer.appendChild(outerDiv);
  }


  generateAll() {
    for (const [country, info] of Object.entries(this.data)) {
      this.createTextInfo(country, info);
      this.createSlider(country, info.timeline);
    }
  }
}

///////// To animate /////////

const // firstDots = ["#dot1", "#dot1-2", "#dot1-3", "#dot1-4"],
  //     secondDots = ["#dot2", "#dot2-2", "#dot2-3", "#dot2-4"],
  map = document.getElementById("map"),
  group2 = ["#outlines", ".hotspot"];
(firstDots = document.querySelectorAll(".dot1")),
  (secondDots = document.querySelectorAll(".dot2"));

gsap.registerPlugin(ScrollTrigger);
// console.log('working?');

// for the horizontal scroll

// gsap.set(map, { fill: 'transparent' });

//repeating the hotspots
function revolveOne() {
  var tl = new TimelineMax({
    repeat: -1,
  });

  tl.add("begin1");
  tl.fromTo(
    firstDots,
    1,
    {
      opacity: 0,
      scale: 0,
      transformOrigin: "50% 50%",
    },
    {
      transformOrigin: "50% 50%",
      opacity: 1,
      scale: 1.5,
      ease: Sine.easeOut,
    },
    "begin1"
  );
  tl.to(
    firstDots,
    0.5,
    {
      opacity: 0,
      transformOrigin: "50% 50%",
      scale: 2,
      ease: Sine.easeOut,
    },
    "begin1+=1"
  );

  return tl;
}

function revolveTwo() {
  var tl = new TimelineMax({
    repeat: -1,
  });

  tl.add("begin2");
  tl.fromTo(
    secondDots,
    1,
    {
      opacity: 0,
      scale: 0,
      transformOrigin: "50% 50%",
    },
    {
      transformOrigin: "50% 50%",
      opacity: 1,
      scale: 3,
      ease: Sine.easeOut,
    },
    "begin2+=0.5"
  );
  tl.to(
    secondDots,
    0.5,
    {
      opacity: 0,
      transformOrigin: "50% 50%",
      scale: 3.5,
      ease: Sine.easeOut,
    },
    "begin2+=1.5"
  );

  return tl;
}

var repeat = new TimelineMax();
//adding a relative label becuase otherwise the first will go on forever
// repeat.add("beginBase");
// repeat.add(revolveOne(), "beginBase");
// repeat.add(revolveTwo(), "beginBase");

//interaction
function zoomIn(country) {
  //zooming in part
  // var currentCountry = document.getElementById(country),
  //   s = currentCountry.getBBox(),
  //   newView = "" + s.x + " " + s.y + " " + (s.width + 200) + " " + s.height;
  var currentCountry = document.getElementById(country),
      s = currentCountry.getBBox(),
      // Adjust padding based on screen width
      padding = window.innerWidth < 680 ? 50 : 400, 
      newView = `${s.x - padding/2} ${s.y - padding/2} ${s.width + padding} ${s.height + padding}`;
    // console.log(newView);
    group1 = [
      ".text-" + country,
      ".timeline-" + country,
      ".x-out",
      ".outer-" + country,
    ],
    tl = new TimelineMax();

  tl.add("zIn");
  tl.fromTo(
    map,
    1.5,
    {
      attr: { viewBox: "0 0 1795.2 875.1" },
    },
    {
      attr: { viewBox: newView },
    },
    "zIn"
  );
  tl.to(
    [".text-" + country, ".timeline-" + country, ".outer-" + country],
    0.1,
    {
      // display: "flex",
      visibility: "visible",
    },
    "zIn"
  );
  tl.fromTo(
    group2,
    0.25,
    {
      opacity: 1,
    },
    {
      opacity: 0,
      ease: Circ.easeIn,
    },
    "zIn"
  );
  tl.fromTo(
    currentCountry,
    0.35,
    {
      opacity: 0,
    },
    {
      opacity: 1,
      ease: Circ.easeOut,
    },
    "zIn+=0.5"
  );
  tl.fromTo(
    group1,
    0.5,
    {
      opacity: 0,
    },
    {
      opacity: 0.65,
      ease: Sine.easeOut,
    },
    "zIn+=1"
  );
}

function zoomOut(geo) {
  // This removes all existing ScrollTriggers, preventing conflicts
  ScrollTrigger.getAll().forEach((trigger) => trigger.kill());

  // const slider = document.querySelector(`.outer.outer-${geo} .slider`);
  // console.log('slider on zoom out:', slider);
  //   if (slider) {
  //       gsap.set(slider, { xPercent: 0, x: 0 }); // Resets the horizontal scroll to the start
  //   }

  //zooming out part
  var currentArea = document.getElementById(geo),
    group3 = [".text-" + geo, ".timeline-" + geo, ".outer-" + geo, ".x-out"],
    tl = new TimelineMax();

  tl.add("zOut");
  tl.to(
    [group3],
    0.5,
    {
      opacity: 0,
      ease: Sine.easeIn,
    },
    "zOut"
  );
  tl.to(
    ".x-out",
    {
      opacity: 0,
      ease: Sine.easeIn,
    },
    "zOut+=0.5"
  );
  tl.to(
    map,
    1,
    {
      attr: { viewBox: "0 0 1795.2 875.1" },
    },
    "zOut"
  );
  tl.to(
    group2,
    0.25,
    {
      opacity: 1,
      ease: Sine.easeOut,
    },
    "zOut+=2"
  );
  tl.to(
    [".text-" + geo, ".timeline-" + geo, ".outer-" + geo],
    // [".text-" + geo, ".timeline-" + geo],
    0.1,
    {
      // display: "none",
      visibility: "hidden",
    },
    "zOut<="
  );
  tl.to(
    currentArea,
    1,
    {
      opacity: 0,
      ease: Sine.easeIn,
    },
    "zOut+=0.4"
  );
}

function timelineCountry(country) {
  //timeline part
  const timeLine = document.querySelector(
    ".timeline-" + country + " .timeline-graph"
  );
  const dates = gsap.utils.toArray(
    ".timeline-" + country + " .timeline-list li"
  );
  console.log(dates);
  var tl = new TimelineMax();
  tl.add("beginTimeline");
  tl.fromTo(
    timeLine,
    { width: 0 },
    { width: "100%", duration: 3, ease: Sine.easeOut },
    "beginTimeline+=0.5"
  );
  tl.fromTo(
    timeLine,
    { opacity: 0 },
    { opacity: 1, duration: 0.5, ease: Sine.easeOut },
    "beginTimeline+=1"
  );
}

const hotspot = document.querySelectorAll(".hotspot");
const xOut = document.querySelector(".x-out");

hotspot.forEach((spot) =>
  spot.addEventListener("click", function () {
    const area = this.getAttribute("data-name");
    xOut.setAttribute("data-info", area);
    zoomIn(area);
    timelineCountry(area);
    timelineHistory(area);
  })
);

xOut.addEventListener("click", function () {
  const area = this.getAttribute("data-info");
  zoomOut(area);
});

// animation for the timeline history

// function timelineHistory(country) {
//     const smallImages = gsap.utils.toArray(".img-container img");
//     const slider = document.querySelector(`.outer.outer-${country} .slider`);
//     console.log(slider);
//     const sections = gsap.utils.toArray(`.outer-${country} .slider section`);
//     console.log(sections);
//     const hearts = gsap.utils.toArray(".img-container img");
//     console.log(hearts);

//     let tl = gsap.timeline({
//         defaults: {
//             ease: "none",
//         },
//         scrollTrigger: {
//             trigger: slider,
//             pin: true,
//             scrub: 2,
//             end: () => "+=" + slider.offsetWidth,
//         },
//     });

//     tl.to(slider, {
//         xPercent: -66,
//     });

//     sections.forEach((stop, i) => {
//         tl.from(stop.querySelector(".content"), {
//             yPercent: -120,
//             opacity: 0,
//             ease: "sine.out",
//             duration: 1,
//             scrollTrigger: {
//                 trigger: stop.querySelector(".content"),
//                 start: "left center",
//                 end: "left center",
//                 containerAnimation: tl,
//                 scrub: true,
//                 // markers: true
//             },
//         })
//         .add(() => { console.log( 'im down here')})
//     });

//     smallImages.forEach((img, i) => {
//         gsap.from(img, {
//             xPercent: img.dataset.distance,
//             scrollTrigger: {
//                 scrub: 0.3,
//             },
//         });
//     });
// }

// slider.style.width = `${sections.length * 100}vw`;

// --- REPLACE THIS: ---
  // tl.to(slider, {
  //   // xPercent: -(((sections.length - 1) * 100) / sections.length),
  //   xPercent: -66
  // });
   const sections = gsap.utils.toArray(
    `.outer .slider section`
  );

// --- WITH THIS: ---
  // const numSections = sections.length;
  // let xPercentTarget = 0;
  
  // // Only apply scrolling if there is more than one section
  // if (numSections > 1) {
  //   // This formula dynamically calculates the correct percentage to move
  //   xPercentTarget = -(((numSections - 1) * 100) / numSections);
  // }

  // tl.to(slider, {
  //   xPercent: xPercentTarget
  // });
// --- END OF CHANGE ---

function timelineHistory(country) {
  // requestAnimationFrame(() => {
  // requestAnimationFrame(() => {
  const slider = document.querySelector(`.outer.outer-${country} .slider`);

  
  const sections = gsap.utils.toArray(
    `.outer.outer-${country} .slider section`
  );
    const numSections = sections.length;
  let xPercentTarget = 0;
  
  // Only apply scrolling if there is more than one section
  if (numSections > 1) {
    // This formula dynamically calculates the correct percentage to move
    xPercentTarget = -(((numSections - 1) * 100) / numSections);
  }
  slider.style.width = `${sections.length * 100}vw`;

  if (!slider || sections.length === 0) return;

  let tl = gsap.timeline({
    defaults: {
      ease: "none",
    },
    scrollTrigger: {
      trigger: slider,
      pin: true,
      scrub: 2,
      end: () => "+=" + slider.offsetWidth,
      invalidateOnRefresh: true,
    },
  });

   tl.to(slider, {
    xPercent: xPercentTarget
  });
  // tl.to(slider, {
  //   // xPercent: -(((sections.length - 1) * 100) / sections.length),
  //   xPercent: -66
  // });

  sections.forEach((stop) => {
    tl.from(stop.querySelector(".content"), {
      yPercent: -60,
      opacity: 1,
      ease: "sine.out",
      duration: 1,
      scrollTrigger: {
        trigger: stop.querySelector(".content"),
        start: "left center",
        end: "left center",
        containerAnimation: tl,
        scrub: true,
      },
    });
  });

  // smallImages.forEach((img, i) => {
  //   gsap.from(img, {
  //     xPercent: img.dataset.distance,
  //     scrollTrigger: {
  //       scrub: 0.3,
  //     },
  //   });
  // });

  // });
  //  });
}

ScrollTrigger.getAll().forEach((trigger) => trigger.kill());
